<!DOCTYPE html>
<html lang="mg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Mi.M.Mi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body { background: #f0f2f5; font-family: sans-serif; }
        .admin-header { background: #0d47a1; color: white; padding: 20px; border-radius: 0 0 25px 25px; margin-bottom: 25px; }
        .member-card { background: white; border-radius: 20px; padding: 15px; margin-bottom: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .solfo-badge { background: #e3f2fd; color: #0d47a1; font-weight: bold; padding: 5px 15px; border-radius: 50px; }
        .btn-update { background: #e91e63; color: white; border-radius: 50px; border: none; }
    </style>
</head>
<body>

    <div class="admin-header text-center shadow">
        <h2 class="fw-bold mb-0">Fitantanana Mi.M.Mi</h2>
        <p class="small opacity-75">Tontonana ho an'ny Cotisation sy Mpikambana</p>
    </div>

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold"><i class="bi bi-people-fill me-2"></i>Mpikambana rehetra</h5>
            <span id="memberCount" class="badge bg-dark rounded-pill">0</span>
        </div>

        <div id="adminContent">
            <div class="text-center p-5 text-muted">Mbola mitsidika ny angon-drakitra...</div>
        </div>
    </div>

    <script>
        function loadMembers() {
            fetch('/api/members')
            .then(res => res.json())
            .then(data => {
                document.getElementById('memberCount').innerText = data.length;
                const div = document.getElementById('adminContent');
                if(data.length === 0) {
                    div.innerHTML = "<p class='text-center'>Tsy mbola misy mpikambana.</p>";
                    return;
                }
                div.innerHTML = data.map(m => `
                    <div class="member-card animate__animated animate__fadeIn">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="fw-bold mb-0">${m.anarana}</h6>
                                <small class="text-muted">${m.mmm_id}</small>
                            </div>
                            <div class="solfo-badge">${m.solfo.toLocaleString()} Ar</div>
                        </div>
                        <div class="mt-3 p-2 bg-light rounded-3">
                            <label class="small fw-bold mb-1">Hampiditra Cotisation (Ar):</label>
                            <div class="input-group">
                                <input type="number" id="amt-${m.mmm_id}" class="form-control form-control-sm border-0 shadow-none" placeholder="Ohatra: 2000">
                                <button class="btn btn-update btn-sm px-3" onclick="addSolfo('${m.mmm_id}')">Havaozina</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            });
        }

        function addSolfo(id) {
            const amt = document.getElementById('amt-' + id).value;
            if(!amt || amt <= 0) return alert("Ampidiro ny sandany marina");
            
            if(!confirm("Hampiditra " + amt + " Ar amin'i " + id + " ve ianao?")) return;

            fetch('/api/admin/update-solfo', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ mmm_id: id, amount: amt })
            })
            .then(res => res.json())
            .then(data => {
                if(data.success) {
                    alert("✅ Cotisation voaray! Solfo vaovao: " + data.newSolfo + " Ar");
                    loadMembers();
                } else {
                    alert("❌ Nisy fahadisoana: " + data.error);
                }
            });
        }

        // Voalohany indrindra
        loadMembers();
    </script>
</body>
</html>

